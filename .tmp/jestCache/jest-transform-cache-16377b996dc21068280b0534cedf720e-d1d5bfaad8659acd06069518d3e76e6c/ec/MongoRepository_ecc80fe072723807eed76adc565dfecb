83ca98cb507f0122daee2814a7005516
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.MongoRepository = void 0;
const DateValueObject_1 = require("../../../domain/value-object/DateValueObject");
class MongoRepository {
    constructor(_client) {
        this._client = _client;
    }
    client() {
        return this._client;
    }
    collection() {
        return __awaiter(this, void 0, void 0, function* () {
            return (yield this._client).db().collection(this.collectionName());
        });
    }
    updateOne(id, aggregateRoot) {
        return __awaiter(this, void 0, void 0, function* () {
            const collection = yield this.collection();
            const document = Object.assign(Object.assign({}, aggregateRoot.toPrimitives()), { _id: id });
            yield collection.updateOne({ _id: id }, { $set: document }, { upsert: true });
        });
    }
    insert(aggregateRoot) {
        return __awaiter(this, void 0, void 0, function* () {
            const collection = yield this.collection();
            const document = Object.assign({}, aggregateRoot.toPrimitives());
            yield collection.insertOne(document);
        });
    }
    delete(id) {
        return __awaiter(this, void 0, void 0, function* () {
            const collection = yield this.collection();
            collection.updateOne({ _id: id }, { $set: { deletedAt: new DateValueObject_1.DateValueObject(new Date()).value } });
        });
    }
}
exports.MongoRepository = MongoRepository;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxqb3NlYVxcRG9jdW1lbnRzXFx3b3JkbGVcXHNyY1xcQ29udGV4dHNcXHNoYXJlZFxcaW5mcmFzdHJ1Y3R1cmVcXHBlcnNpc3RlbmNlXFxtb25nb1xcTW9uZ29SZXBvc2l0b3J5LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUVBLGtGQUE4RTtBQUU5RSxNQUFzQixlQUFlO0lBQ3BDLFlBQW9CLE9BQTZCO1FBQTdCLFlBQU8sR0FBUCxPQUFPLENBQXNCO0lBQUcsQ0FBQztJQUkzQyxNQUFNO1FBQ2YsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFBO0lBQ3BCLENBQUM7SUFFZSxVQUFVOztZQUN6QixPQUFPLENBQUMsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQyxDQUFBO1FBQ25FLENBQUM7S0FBQTtJQUVlLFNBQVMsQ0FBQyxFQUFVLEVBQUUsYUFBZ0I7O1lBQ3JELE1BQU0sVUFBVSxHQUFHLE1BQU0sSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFBO1lBRTFDLE1BQU0sUUFBUSxtQ0FBUSxhQUFhLENBQUMsWUFBWSxFQUFFLEtBQUUsR0FBRyxFQUFFLEVBQUUsR0FBRSxDQUFBO1lBRTdELE1BQU0sVUFBVSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFBO1FBQzlFLENBQUM7S0FBQTtJQUVlLE1BQU0sQ0FBQyxhQUFnQjs7WUFDdEMsTUFBTSxVQUFVLEdBQUcsTUFBTSxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUE7WUFFMUMsTUFBTSxRQUFRLHFCQUFRLGFBQWEsQ0FBQyxZQUFZLEVBQUUsQ0FBRSxDQUFBO1lBRXBELE1BQU0sVUFBVSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQTtRQUNyQyxDQUFDO0tBQUE7SUFFZSxNQUFNLENBQUMsRUFBVTs7WUFDaEMsTUFBTSxVQUFVLEdBQUcsTUFBTSxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUE7WUFFMUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLGlDQUFlLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQTtRQUNsRyxDQUFDO0tBQUE7Q0FDRDtBQWxDRCwwQ0FrQ0MiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxqb3NlYVxcRG9jdW1lbnRzXFx3b3JkbGVcXHNyY1xcQ29udGV4dHNcXHNoYXJlZFxcaW5mcmFzdHJ1Y3R1cmVcXHBlcnNpc3RlbmNlXFxtb25nb1xcTW9uZ29SZXBvc2l0b3J5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbGxlY3Rpb24sIE1vbmdvQ2xpZW50IH0gZnJvbSAnbW9uZ29kYidcbmltcG9ydCB7IEFnZ3JlZ2F0ZVJvb3QgfSBmcm9tICcuLi8uLi8uLi9kb21haW4vQWdncmVnYXRlUm9vdCdcbmltcG9ydCB7IERhdGVWYWx1ZU9iamVjdCB9IGZyb20gJy4uLy4uLy4uL2RvbWFpbi92YWx1ZS1vYmplY3QvRGF0ZVZhbHVlT2JqZWN0J1xuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgTW9uZ29SZXBvc2l0b3J5PFQgZXh0ZW5kcyBBZ2dyZWdhdGVSb290PiB7XG5cdGNvbnN0cnVjdG9yKHByaXZhdGUgX2NsaWVudDogUHJvbWlzZTxNb25nb0NsaWVudD4pIHt9XG5cblx0cHJvdGVjdGVkIGFic3RyYWN0IGNvbGxlY3Rpb25OYW1lKCk6IHN0cmluZ1xuXG5cdHByb3RlY3RlZCBjbGllbnQoKTogUHJvbWlzZTxNb25nb0NsaWVudD4ge1xuXHRcdHJldHVybiB0aGlzLl9jbGllbnRcblx0fVxuXG5cdHByb3RlY3RlZCBhc3luYyBjb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbj4ge1xuXHRcdHJldHVybiAoYXdhaXQgdGhpcy5fY2xpZW50KS5kYigpLmNvbGxlY3Rpb24odGhpcy5jb2xsZWN0aW9uTmFtZSgpKVxuXHR9XG5cblx0cHJvdGVjdGVkIGFzeW5jIHVwZGF0ZU9uZShpZDogc3RyaW5nLCBhZ2dyZWdhdGVSb290OiBUKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0Y29uc3QgY29sbGVjdGlvbiA9IGF3YWl0IHRoaXMuY29sbGVjdGlvbigpXG5cblx0XHRjb25zdCBkb2N1bWVudCA9IHsgLi4uYWdncmVnYXRlUm9vdC50b1ByaW1pdGl2ZXMoKSwgX2lkOiBpZCB9XG5cblx0XHRhd2FpdCBjb2xsZWN0aW9uLnVwZGF0ZU9uZSh7IF9pZDogaWQgfSwgeyAkc2V0OiBkb2N1bWVudCB9LCB7IHVwc2VydDogdHJ1ZSB9KVxuXHR9XG5cblx0cHJvdGVjdGVkIGFzeW5jIGluc2VydChhZ2dyZWdhdGVSb290OiBUKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0Y29uc3QgY29sbGVjdGlvbiA9IGF3YWl0IHRoaXMuY29sbGVjdGlvbigpXG5cblx0XHRjb25zdCBkb2N1bWVudCA9IHsgLi4uYWdncmVnYXRlUm9vdC50b1ByaW1pdGl2ZXMoKSB9XG5cblx0XHRhd2FpdCBjb2xsZWN0aW9uLmluc2VydE9uZShkb2N1bWVudClcblx0fVxuXG5cdHByb3RlY3RlZCBhc3luYyBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuXHRcdGNvbnN0IGNvbGxlY3Rpb24gPSBhd2FpdCB0aGlzLmNvbGxlY3Rpb24oKVxuXG5cdFx0Y29sbGVjdGlvbi51cGRhdGVPbmUoeyBfaWQ6IGlkIH0sIHsgJHNldDogeyBkZWxldGVkQXQ6IG5ldyBEYXRlVmFsdWVPYmplY3QobmV3IERhdGUoKSkudmFsdWUgfSB9KVxuXHR9XG59XG4iXSwidmVyc2lvbiI6M30=